!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Fastly=e()}(this,(function(){"use strict";function t(t,e){return t.exports||(t.path=e,t.exports={},t.call(t.exports,t,t.exports,(function(t){if("."!=t.charAt(0))return i(t);let s=t.split("/"),r=e.split("/");r.pop();for(let t=0;t<s.length;t++){let e=s[t];".."==e?r.pop():"."!=e&&r.push(e)}return i(r.join("/"))}))),t.exports}let e={};function i(i){i=e[i+".js"]&&i+".js"||i;let s=e[i],r=null;switch(typeof s){case"function":r=t(s,i);break;case"object":r=s}return r}var s=Object.freeze({__proto__:null,modules:e,define:function(i,s){let r=null;switch(typeof i){case"string":e[i]=s;break;case"function":r=t(i,"")}return r},require:i});function r(t,e){let i=!1;if(0!==t.length)for(let s=0;s<t.length;s++)if(t[s]===e){i=!0;break}return i}let n=["SUPER","SUPERCLASSES","SUBCLASSES","_super","_superMethods"],h={Extends:function(t){if(t){let e=function(){};e.prototype=t.prototype;let i=new e,s=this.prototype;o(this,[t],n),o(i,[s]),i.constructor=this,this.prototype=i,this.SUPER=t,this.SUPERCLASSES=[t];for(let e=t.SUPERCLASSES.length-1;e>=0;e--)this.SUPERCLASSES.push(t.SUPERCLASSES[e]);0!==t.SUBCLASSES.length&&t.SUBCLASSES.push(this)||(t.SUBCLASSES=[this])}},Static:function(t){t&&o(this,[t],n)},Mixes:function(t){if(t)for(let e in t)o(this.prototype,[t[e].prototype||t[e]])},Prototype:function(t){t&&o(this.prototype,[t])}};function o(t,e,i=[]){for(let s=0;s<e.length;s++){let n,h=e[s];for(let e in h){let s=h[e];r(i,e)||(!s||"object"!=typeof s||void 0===s.value&&"function"!=typeof s.get&&"function"!=typeof s.set&&"boolean"!=typeof s.writable&&"boolean"!=typeof s.configurable&&"boolean"!=typeof s.enumerable?t[e]=s:(n=n||{},n[e]=s))}n&&Object.defineProperties(t,n)}return t}var a=Object.freeze({__proto__:null,create:function(t={}){let e=function(...t){e._super(this,t)};t.Initialize&&(e=t.Initialize),e.SUPER=null,e.SUPERCLASSES=[],e.SUBCLASSES=[],e._super=function(t,i=[]){return e.SUPER&&e.SUPER.apply(t,i)},e._superMethods=function(t,i,s=[]){return e.SUPER&&e.SUPER.prototype[i].apply(t,s)};for(let i in h)t.hasOwnProperty(i)&&h[i].call(e,t[i]);return e},mix:o,debug:function(t){let e={},i={},s=[];function r(t,e){for(let i in e)t[i]=e[i];return t}r(e,t),r(i,t.prototype);for(let e=t.SUPERCLASSES.length-1;e>=0;e--)s.push({static:r({},t.SUPERCLASSES[e]),prototype:r({},t.SUPERCLASSES[e].prototype)});return{extends:s,static:e,prototype:i}}});function l(t,e=!1){let i="";if(0!==arguments.length)if(null==t)i=String(t);else{let s=e?t.prototype:t.__proto__;null!=s&&(i=s.constructor.name)}return i}var u=Object.freeze({__proto__:null,is:function(t,e){let i=e.prototype;for(t=t.__proto__;;){if(null==t)return!1;if(i===t)return!0;t=t.__proto__}},get:l,ls:function(t,e=!1){let i=[];if(0!==arguments.length)if(null==t)i.push(String(t));else{let s=e?t.prototype:t.__proto__;for(;null!=s;)i.push(s.constructor.name),s=s.__proto__}return i}});let d=function(t,e){let i=l(t);if("null"===i||"undefined"===i||"Boolean"===i||"Number"===i||"String"===i||"Symbol"===i)return t;if("Date"===i)return new Date(t.valueOf());if("RegExp"===i)return new RegExp(t);let s="Function"===i?new Function("return "+t.toString())():"Array"===i?[]:{};for(let i in t)s[i]=e?e(t[i]):t[i];return e&&"Function"===i&&(s.prototype=e(t.prototype)),s};function c(t,e=!1,i=d){return e?i(t,(function(t){return c(t,e,i)})):i(t)}function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}class f{constructor(t){this.ele=t,this.prev=null,this.next=null}}class _{constructor(t){this.reset(t)}get isEmpty(){return 0===this.ele.length}get size(){return this.ele.length}clear(){this.ele=[]}reset(t){if(this.clear(),t)for(let e=0;e<t.length;e++)this.add(t[e])}add(t){return this.indexOf(t)<0&&this.ele.push(t),this}delete(t){let e=this.indexOf(t);return e>-1&&this.ele.splice(e,1),this}has(t){return this.indexOf(t)>-1}indexOf(t){for(let e=0;e<this.ele.length;e++)if(this.ele[e]===t)return e;return-1}forEach(t){let e=0;for(;e++<this.ele.length&&!1!==t(e,this.ele[e]););}union(t){let e=new _(this.ele);for(let i=0;i<t.ele.length;++i)e.has(t.ele[i])||e.ele.push(t.ele[i]);return e}intersect(t){let e=new _;for(let i=0;i<this.ele.length;++i)t.has(this.ele[i])&&e.add(this.ele[i]);return e}complement(t){let e=new _;for(let i=0;i<t.ele.length;++i)this.has(t.ele[i])||e.add(t.ele[i]);return e}difference(t){let e=[];return e=e.concat(t.complement(this).ele),e=e.concat(this.complement(t).ele),new _(e)}}var m=Object.freeze({__proto__:null,commonJS:s,klass:a,types:u,clone:c,uuid:p,list:class{constructor(t){this.reset(t)}get getHead(){return this._head}get getTail(){return this._tail}get isEmpty(){return 0===this._length}get size(){return this._length}reset(t){if(this._head=null,this._tail=null,this._length=0,t)for(let e=0;e<t.length;e++)this.append(t[e])}append(t){return this.insert(this._length,t),this}prepend(t){return this.insert(0,t),this}find(t){let e=null;if(t>=0&&t<this._length){let i=0;for(e=this._head;e&&++i<=t;)e=e.next}return e}insert(t,e){if(t>=0&&t<=this._length){let i=0,s=new f(e),r=this._head,n=null;if(0===t)this._head?(this._head=s,this._head.prev=this._tail,this._head.next=r,r.prev=s,this._tail.next=s):(this._head=s,this._tail=s,s.prev=s,s.next=s);else if(t===this._length)r=this._tail,this._tail=s,this._tail.prev=r,this._tail.next=this._head,this._head.prev=s,r.next=s;else{for(;i++<t;)n=r,r=r.next;s.prev=n,s.next=r,n.next=s,r.prev=s}return this._length++,!0}return!1}remove(t){if(t>=0&&t<this._length){let e=0,i=this._head,s=null;if(0===t)this._head=i.next,this._head.prev=this._tail,this._tail.next=this._head;else if(t===this._length-1)this._tail=this._tail.prev,this._head.prev=this._tail,this._tail.next=this._head;else{for(;e++<t;)s=i,i=i.next;s.next=i.next,i.next.prev=s}return this._length--,!0}return!1}forEach(t){let e=this._head,i=0;for(;e&&i++<this._length&&!1!==t(i,e.ele);)e=e.next}valueAt(t){let e=this.find(t);return null===e?e:e.ele}indexOf(t){let e=this._head,i=0;for(;e&&i++<this._length;){if(e.ele===t)return i;e=e.next}return-1}toArray(){let t=this._head,e=0,i=[];for(;t&&e<this._length;)i.push(t.ele),t=t.next,e++;return i}},sets:_,maps:class{constructor(t){this.reset(t)}get isEmpty(){return 0===this._ele.length}get size(){return this._ele.length}clear(){this._ele=[]}reset(t){if(this.clear(),t)for(let e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}set(t,e){let i=this.indexOf(t);return i>-1?this._ele[i].v=e:this._ele.push({k:t,v:e}),this}get(t){let e=this.indexOf(t);return e>-1?this._ele[e].v:null}has(t){return this.indexOf(t)>-1}delete(t){let e=this.indexOf(t);return e>-1&&this._ele.splice(e,1),this}index(t){return this._ele[t]?this._ele[t].v:null}indexOf(t){for(let e=0;e<this._ele.length;e++)if(this._ele[e].k===t)return e;return-1}forEach(t){for(let e=0;e<this._ele.length&&!1!==t(this._ele[e].k,this._ele[e].v);e++);}keys(){var t=[];for(let e=0;e<this._ele.length;e++)t.push(this._ele[e].k);return t}values(){var t=[];for(let e=0;e<this._ele.length;e++)t.push(this._ele[e].v);return t}}});let g={name:"Fastly",version:"v1.0.0",developer:"PJX",introduction:"Canvas2D游戏框架",createTime:"2021-7-3",updateTime:"2022-3-20"},y=window,x=navigator.userAgent,b=document,v=document.documentElement,w=Math,S=AudioContext,T=console;var k=Object.freeze({__proto__:null,Global_Info:g,Global_Win:y,Global_Ua:x,Global_Doc:b,Global_Ele:v,Global_Math:w,Global_AudioContext:S,Global_Console:T});function C(t,e,i){let s,r,n,h,o=0,a=!1;for(let l=0,u=i.length;l<u;l++){let d=i[l],c=i[(l+1)%u];if(d.y==c.y&&e==d.y&&(d.x>c.x?(s=c.x,r=d.x):(s=d.x,r=c.x),t>=s&&t<=r)){a=!0;continue}if(d.y>c.y?(n=c.y,h=d.y):(n=d.y,h=c.y),e<n||e>h)continue;let p=(e-d.y)*((c.x-d.x)/(c.y-d.y))+d.x;if(p>t?o++:p==t&&(a=!0),d.x>t&&d.y==e){let t=i[(u+l-1)%u];(t.y<e&&c.y>e||t.y>e&&c.y<e)&&o++}}return a||o%2==1}function A(t,e){let i=A.doSATCheck(t,e,{overlap:-1/0,normal:{x:0,y:0}});return!!i&&A.doSATCheck(e,t,i)}A.doSATCheck=function(t,e,i){let s,r,n,h,o,a,l,u,d,c=t.length,p=e.length,f={x:0,y:0};for(let _=0;_<c;_++){s=t[_],r=t[_<c-1?_+1:0],f.x=s.y-r.y,f.y=r.x-s.x,n=w.sqrt(f.x*f.x+f.y*f.y),f.x/=n,f.y/=n,h=o=t[0].x*f.x+t[0].y*f.y;for(let e=1;e<c;e++)u=t[e].x*f.x+t[e].y*f.y,u>o?o=u:u<h&&(h=u);a=l=e[0].x*f.x+e[0].y*f.y;for(let t=1;t<p;t++)u=e[t].x*f.x+e[t].y*f.y,u>l?l=u:u<a&&(a=u);if(h<a?(d=a-o,f.x=-f.x,f.y=-f.y):d=h-l,d>=0)return!1;d>i.overlap&&(i.overlap=d,i.normal.x=f.x,i.normal.y=f.y)}return i};var O=Object.freeze({__proto__:null,Polygon_PointContains:C,Polygon_PolyContains:A});let P=/iphone/i.test(x),E=/ipad/i.test(x),I=/ipod/i.test(x),R=/iphone|ipad|ipod/i.test(x),D=/android/i.test(x),F=/chrome/i.test(x),L=/webkit/i.test(x),N=/safari/i.test(x),M=/firefox/i.test(x),z=/opera/i.test(x),U=/msie/i.test(x),B=L?"webkit":M?"moz":z?"o":U?"ms":"",j="ontouchstart"in y,H=null!==b.createElement("canvas").getContext,V=!1;try{let t="test";localStorage.setItem(t,t),localStorage.removeItem(t),V=!0}catch(t){}let W="orientation"in y||"orientation"in y.screen,K="ondevicemotion"in y;function q(t,e,i,s){(s=!1!==s)?t.addEventListener(e,i,!1):t.removeEventListener(e,i)}function G(t,e){let i=b.createElement(t);for(let t in e){let s=e[t];if("style"===t)for(let t in s)i.style[t]=s[t];else i[t]=s}return i}function X(t){let e=(y.pageXOffset||v.scrollLeft)-(v.clientLeft||0)||0,i=(y.pageYOffset||v.scrollTop)-(v.clientTop||0)||0,s=void 0!==y.getComputedStyle?getComputedStyle(t):t.currentStyle,r=parseInt(s.paddingLeft)+parseInt(s.borderLeftWidth)||0,n=parseInt(s.paddingTop)+parseInt(s.borderTopWidth)||0,h=parseInt(s.paddingRight)+parseInt(s.borderRightWidth)||0,o=parseInt(s.paddingBottom)+parseInt(s.borderBottomWidth)||0,a=t.offsetTop||0,l=t.offsetLeft||0;return{left:l+e+r,top:a+i+n,width:(t.offsetLeft+t.offsetWidth||0)-h-l-r,height:(t.offsetTop+t.offsetHeight||0)-o-a-n}}function Y(t){let e="",i=Y.$DOM;for(let i=0;i<t.length;i++){let s=t[i];"string"==typeof s&&(s=s.replace(/</g,"&lt;").replace(/>/g,"&gt;")),0===i?e=s:e+=" "+s}i.innerHTML="> "+e+"<br/>"+i.innerHTML,i.scrollTop=i.scrollHeight-i.clientHeight,v.appendChild(i)}Y.$DOM=G("div",{className:g.name+"-Log",style:{position:"absolute",bottom:"0",left:"0",width:"100%",maxHeight:"200px",boxSizing:"border-box",font:"12px Courier New",backgroundColor:"rgba(0,0,0,0.2)",wordWrap:"break-word",wordBreak:"break-all",overflowY:"scroll",padding:"5px",zIndex:1e6}});var J=Object.freeze({__proto__:null,isIphone:P,isIpad:E,isIpod:I,isIOS:R,isAndroid:D,isChrome:F,isWebkit:L,isSafari:N,isFirefox:M,isOpera:z,isIE:U,jsVendor:B,isTouch:j,isCanvas:H,get isStorage(){return V},isOrientation:W,isDevicemotion:K,enableEvent:q,createElement:G,getElementRect:X,elementsLog:Y,consoleGroup:function(t,e){let i="",s=[];for(let e in t){let r="";for(let i in t[e][1])r+=i+":"+t[e][1][i]+";";s.push(r),i+="%c"+t[e][0]}T.group.apply(T,[i].concat(s)),e&&e(),T.groupEnd()},consoleLog:function(t){let e="",i=[];for(let s in t){let r="";for(let e in t[s][1])r+=e+":"+t[s][1][e]+";";i.push(r),e+="%c"+t[s][0]}T.log.apply(T,[e].concat(i))}});function Q(t=g.name){return Q.UID[t]||(Q.UID[t]=0),t+"_"+(++Q.UID[t]).toString()}function $(t,e,i=!1){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((s=>{"constructor"===s||!i&&t.prototype.hasOwnProperty(s)||(t.prototype[s]=e.prototype[s])}))})),t}function Z(t,e=!1){return function(i){$(i,t,e)}}function tt(t,e,i=!1){return e.forEach((e=>{Object.getOwnPropertyNames(e).forEach((s=>{(i||t.hasOwnProperty(s))&&(t[s]=e[s])}))})),t}function et(t,e,i=0){let s;if(t&&t.hasOwnProperty(e))switch(i){case 0:s=t[e];break;case 1:s=c(t[e]);break;case 2:s=c(t[e],!0)}return s}function it(t,e){return e?t+2*(w.random()-.5)*e:t}function st(){return(new y.Date).getTime()}Q.UID={};var rt=Object.freeze({__proto__:null,uniqueName:Q,mixinsClass:$,mixinsClassDecorator:Z,mixinsJson:tt,mixinsJsonDecorator:function(t,e=!1){return function(i){tt(i,t,e)}},getJsonVal:et,getRandomValue:it,nowDate:st});class nt{constructor(){this._min=1/0,this._max=0}update(t,e){let i=w.round;return this._min=w.min(this._min,t),this._max=w.max(this._max,t),{min:i(this._min),max:i(this._max),val:i(t),pct:t/e}}}var ht=Object.freeze({__proto__:null,panel:nt,stats:class{constructor(t={}){this._prevTime=this._beginTime=st(),this._frames=0,this._fps=new nt,this._ms=new nt,this.onFPS=t.onFPS||function(){},this.onMS=t.onMS||function(){}}begin(){this._beginTime=st()}update(){this._beginTime=this.end()}end(){this._frames++;let t=Date.now();return this.onMS(this._ms.update(t-this._beginTime,200)),t>=this._prevTime+1e3&&(this.onFPS(this._fps.update(1e3*this._frames/(t-this._prevTime),100)),this._prevTime=t,this._frames=0),t}}});
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function ot(t,e,i,s){var r,n=arguments.length,h=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(h=(n<3?r(h):n>3?r(e,i,h):r(e,i))||h);return n>3&&h&&Object.defineProperty(e,i,h),h}class at{static CTOR(t){t._listeners={}}on(t,e,i=-1){let s=this._listeners[t]=this._listeners[t]||[];for(let t=0;t<s.length;t++)if(s[t].callback===e)return this;return s.push({callback:e,complete:0,total:i}),this}off(t,e){if(0===arguments.length)this._listeners={};else if(t&&this._listeners[t])if(1===arguments.length)delete this._listeners[t];else{let i=this._listeners[t];for(let s=0;s<i.length;s++)if(i[s].callback===e){i.splice(s,1),0===i.length&&delete this._listeners[t];break}}return this}emit(t){if(!this._listeners)return!1;let e=this._listeners[t.type];if(e){let i=t,s=e.slice(0);for(let t=0;t<s.length;t++){let r=s[t];if(r.total>-1){if(r.total>r.complete&&(r.callback.call(this,i),r.complete++),r.total<=r.complete){let t=e.indexOf(r);t>-1&&e.splice(t,1)}}else r.callback.call(this,i)}return 0===e.length&&delete this._listeners[t.type],!0}return!1}emitFn(t,e){if(!this._listeners)return;let i=this._listeners[t];if(i){let s=i.slice(0);for(let t=0;t<s.length;t++){let r=s[t];if(r.total>-1){if(r.total>r.complete&&(r.callback.call(this,e(r)),r.complete++),r.total<=r.complete){let t=i.indexOf(r);t>-1&&i.splice(t,1)}}else r.callback.call(this,e(r))}0===i.length&&delete this._listeners[t]}}}class lt{constructor(...t){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,6===t.length&&this.set(t[0],t[1],t[2],t[3],t[4],t[5])}set(...t){return this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.tx=t[4],this.ty=t[5],this}identity(){return this.set(1,0,0,1,0,0)}copyTo(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}clone(){return(new lt).copyTo(this)}equals(t){return t instanceof lt&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.tx===t.tx&&this.ty===t.ty}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.append(t,0,0,e,0,0)}rotate(t){let e=w.sin(t),i=w.cos(t);return this.append(i,e,-e,i,0,0)}skew(t,e){return this.append(1,w.tan(e),w.tan(t),1,0,0)}prepend(t,e,i,s,r,n){if(t instanceof lt)return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty);if(void 0!==t&&void 0!==e&&void 0!==i&&void 0!==s&&void 0!==r&&void 0!==n){let h=this.a,o=this.b,a=this.c,l=this.d,u=this.tx,d=this.ty;this.a=t*h+e*a,this.b=t*o+e*l,this.c=i*h+s*a,this.d=i*o+s*l,this.tx=r*h+n*a+u,this.ty=r*o+n*l+d}return this}append(t,e,i,s,r,n){if(t instanceof lt)return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty);if(void 0!==t&&void 0!==e&&void 0!==i&&void 0!==s&&void 0!==r&&void 0!==n){let h=this.a,o=this.b,a=this.c,l=this.d,u=this.tx,d=this.ty;this.a=t*h+i*o,this.b=e*h+s*o,this.c=t*a+i*l,this.d=e*a+s*l,this.tx=t*u+i*d+r,this.ty=e*u+s*d+n}return this}invert(){let t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,n=this.ty,h=t*s-i*e;return this.a=s/h,this.b=-e/h,this.c=-i/h,this.d=t/h,this.tx=(i*n-s*r)/h,this.ty=(e*r-t*n)/h,this}}class ut{constructor(t,e){this.set(t||0,e||0)}get length(){return w.sqrt(this.x*this.x+this.y*this.y)}get angle(){return w.atan2(this.y,this.x)}set(t,e){return this.x=t,this.y=e,this}copyTo(t){return this.x=t.x,this.y=t.y,this}clone(){return(new ut).copyTo(this)}equal(t){return this.x===t.x&&this.y===t.y}dotProduct(t,e){return t instanceof ut?this.x*t.x+this.y*t.y:this.x*t+this.y*(void 0===e?t:e)}normalize(){let t=this.length;return this.x=this.x/t,this.y=this.y/t,this}inverse(){return this.x*=-1,this.y*=-1,this}scale(t,e){return this.x*=t,this.y*=void 0===e?t:e,this}rotate(t){let e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this}toArray(){return[this.x,this.y]}toAdd(t,e){return t instanceof ut?(this.x+=t.x,this.y+=t.y):void 0!==t&&void 0!==e&&(this.x+=t,this.y+=e),this}toSubtract(t,e){return t instanceof ut?(this.x-=t.x,this.y-=t.y):void 0!==t&&void 0!==e&&(this.x-=t,this.y-=e),this}toDistance(t){return w.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}toTransform(t,e){let i=this.x*t.a+this.y*t.c+t.tx,s=this.x*t.b+this.y*t.d+t.ty;return e&&(i=i+.5>>0,s=s+.5>>0),this.x=i,this.y=s,this}}class dt{constructor(t={}){this.timeStamp=st(),this.type=et(t,"type")||"",this.target=et(t,"target")||null}}class ct extends dt{constructor(t={}){super(t),this._stopPropagationed=!1,this.type=et(t,"type")||"",this.target=et(t,"target")||null,this.eventTarget=et(t,"eventTarget")||null,this.prevTarget=et(t,"prevTarget")||null,this.mode=et(t,"mode")||"mouse",this.pointX=et(t,"pointX")||0,this.pointY=et(t,"pointY")||0}get stopPropagationed(){return this._stopPropagationed}stopPropagation(){this._stopPropagationed=!0}}class pt{static CTOR(t,e={}){t._isMouseOver=!1,t.pointerEnabled=et(e,"pointerEnabled")||!0,t.pointerCursor=et(e,"pointerCursor")||""}pointerEmitEvent(t){if(t.target=this,this.emit(t),"mousemove"===t.type||"touchmove"===t.type){if(!this._isMouseOver){this._isMouseOver=!0;let e=tt(new ct,[t],!0);e.type="mouse"===e.mode?"mouseover":"touchover",this.emit(e)}}else"mouseout"!==t.type&&"touchout"!==t.type||(this._isMouseOver=!1);let e=this.parent;!t.stopPropagationed&&e&&(("mouseout"===t.type||"touchout"===t.type)&&e.hitTestPoint(t.pointX,t.pointY)||e.pointerEmitEvent(t))}}class ft{constructor(t){this._pointerPrevTarget=null,this.stage=t,this._domEvent=this._domEvent.bind(this)}_domEvent(t){let e=new ct,i=this.stage.viewport,s=this._pointerPrevTarget,r=t,n=t.type,h=0===n.indexOf("touch")?"touch":"mouse",o="mouseout"===n||"touchout"===n;if("touch"===h){let e=t.touches,i=t.changedTouches;r=e&&e.length?e[0]:i&&i.length?i[0]:null}let a=r.pageX||r.clientX,l=r.pageY||r.clientY;e.pointX=a=(a-(i&&i.left||0))/this.stage.layers.scale[0],e.pointY=l=(l-(i&&i.top||0))/this.stage.layers.scale[1],e.type=n,e.mode=h;let u=this.stage.layers.getNodeAtPoint(a,l,!1,!0)||this.stage.layers;if(s&&(o||s!==u)){let t="";if("touchmove"===n?t="touchout":"mousemove"===n?t="mouseout":!o&&u||(t="touch"===h?"touchout":"mouseout"),t){let i=tt(new ct,[e],!0);i.type=t,i.eventTarget=s,s.pointerEmitEvent(i)}e.prevTarget=s,this._pointerPrevTarget=null}!u.pointerEnabled||"mouseout"===n&&"touchout"===n||(e.eventTarget=this._pointerPrevTarget=u,u.pointerEmitEvent(e)),"mouse"===h&&u instanceof _t&&(this.stage.element.style.cursor=u.pointerEnabled&&u.pointerCursor?u.pointerCursor:""),D&&"touchmove"===n&&t.preventDefault()}enable(t=!0){let e=j?["touchstart","touchmove","touchend","touchout"]:["mousedown","mousemove","mouseup","mouseout"];for(let i=0;i<e.length;i++)q(this.stage.element,e[i],this._domEvent,t)}}let _t=class{constructor(t={}){this.id=p(),this.depth=-1,this.parent=null,at.CTOR(this),pt.CTOR(this),this.name=et(t,"name")||Q("Node"),this.x=et(t,"x")||0,this.y=et(t,"y")||0,this.height=et(t,"height")||0,this.width=et(t,"width")||0,this.alpha=et(t,"alpha")||1,this.background=et(t,"background")||"",this.visible=et(t,"visible")||!0,this.blendMode=et(t,"blendMode")||"source-over",this.boundsArea=et(t,"boundsArea")||null,this.drawable=et(t,"drawable")||null,this.mask=et(t,"mask")||null,this.anchor=et(t,"anchor",1)||[0,0],this.rotate=et(t,"rotate")||0,this.scale=et(t,"scale",1)||[1,1],this.skew=et(t,"skew")||[0,0],this.transform=et(t,"transform",1)||[],this._zIndex=et(t,"zIndex")||0,this.onRenderStart=et(t,"onRenderStart")||null,this.onRenderEnd=et(t,"onRenderEnd")||null}get scaledWidth(){return this.width*this.scale[0]}get scaledHeight(){return this.height*this.scale[1]}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&this.parent.renderSort()}addTo(t,e){return"number"==typeof e?t.addChildAt(this,e):t.addChild(this),this}hasParents(t){for(;t.parent&&(t=t.parent);)if(t===this)return!0;return!1}swapNode(t){if(!this.hasParents(t)&&!t.hasParents(this)){let e=this.parent,i=t.parent,s=this.depth,r=t.depth;return e?e.addChildAt(t,s-1):i&&t.removeParent(),i?i.addChildAt(this,r-1):e&&this.removeParent(),!0}return!1}removeParent(){let t=this.parent;return t&&t.removeChild(this),this}toName(){let t="",e=this;for(;e;)t=t?e.name+"."+t:e.name,e=e.parent;return t}renderStartDraw(t,e){return t.startDraw(this)}renderTransform(t,e){t.transform(this)}renderDraw(t,e){t.draw(this)}renderEndDraw(t,e){t.endDraw()}render(t,e){this.onRenderStart&&!this.onRenderStart(e)||(this.renderStartDraw(t,e)&&(this.renderTransform(t,e),this.renderDraw(t,e),this.renderEndDraw(t,e)),this.onRenderEnd&&this.onRenderEnd(e))}getTransformMatrix(){let t=new lt,e=w.PI/180,i=this.transform;if(0!==i.length)for(let e=0;e<i.length;e++){let s=i[e];t.append(s.a,s.b,s.c,s.d,s.tx,s.ty)}else t.translate(-this.anchor[0],-this.anchor[1]),t.skew(this.skew[0]*e,this.skew[1]*e),t.rotate(this.rotate*e),t.scale(this.scale[0],this.scale[1]),t.translate(this.x,this.y);return t}getConcatMatrix(t){let e=new lt;for(let i=this;i!==t&&i.parent;i=i.parent)e.append(i.getTransformMatrix());return e}getBounds(){let t=this.getConcatMatrix(),e=this.width,i=this.height,s=[],r=this.boundsArea||[{x:0,y:0},{x:e,y:0},{x:e,y:i},{x:0,y:i}];for(let e=0;e<r.length;e++)s[e]=new ut(r[e].x,r[e].y).toTransform(t,!0);return s}hitTestPoint(t,e){return C(t,e,this.getBounds())}hitTestObject(t){return A(this.getBounds(),t.getBounds())}};_t=ot([Z([at,pt])],_t);class mt extends _t{constructor(t={}){super(t),this._isRenderChildren=!1,this._renderChildren=[],this.name=et(t,"name")||Q("Container"),this.children=et(t,"children")||[],this.pointChildrenEnabled=et(t,"pointChildrenEnabled")||!0,0!==this.children.length&&this._updateChildren()}get childCount(){return this.children.length}_updateChildren(t,e){let i=this.children;t=t||0,e=e||i.length;for(let s=t;s<e;s++){let t=i[s];t.depth=s+1,t.parent=this}this._isRenderChildren=!0}renderDraw(t,e){super.renderDraw(t,e),this._isRenderChildren&&this.renderSort();let i=this._renderChildren.slice(0);for(let s=0;s<i.length;s++){let r=i[s];r.parent===this&&r.render(t,e)}}hasChild(t){for(;t.parent&&(t=t.parent);)if(t===this)return!0;return!1}getChildAt(t){let e=this.children;return t<0||t>=e.length?null:e[t]}getChildById(t){let e=this.children;for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t)return s}return null}getChildIndex(t){return this.children.indexOf(t)}addChildAt(t,e){let i=this.children,s=i.length,r=t.parent;e=e<0?0:e>s?s:e;let n=this.getChildIndex(t);if(n===e)return this;if(n>=0?(i.splice(n,1),e=e===s?s-1:e):r&&r.removeChild(t),i.splice(e,0,t),n<0)this._updateChildren(e);else{let t=n<e?n:e,i=n<e?e:n;this._updateChildren(t,i+1)}return this}addChild(...t){let e=this.children.length;for(let i=0;i<t.length;i++)this.addChildAt(t[i],e+i);return this}removeChildAt(t){let e=this.children;if(t<0||t>=e.length)return null;let i=e[t];return i&&(i.parent=null,i.depth=-1),e.splice(t,1),this._updateChildren(t),i}removeChild(t){return this.removeChildAt(this.getChildIndex(t))}removeAllChildren(){for(;this.children.length;)this.removeChildAt(0);return this}removeChildById(t){let e=this.children;for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t)return this.removeChildAt(i),s}return null}setChildIndex(t,e){let i=this.children,s=i.indexOf(t);if(s>=0&&s!==e){let r=i.length;e=e<0?0:e>=r?r-1:e,i.splice(s,1),i.splice(e,0,t),this._updateChildren()}return this}renderSort(){this._renderChildren=this.children.slice(0),this._renderChildren.sort((function(t,e){return t.zIndex-e.zIndex})),this._isRenderChildren=!1}getNodeAtPoint(t,e,i,s=!1){this._isRenderChildren&&this.renderSort();let r=[],n=this._renderChildren.slice(0);for(let h=n.length-1;h>=0;h--){let o=null,a=n[h];if(!(!a||!a.visible||a.alpha<=0||s&&!a.pointerEnabled))if(a instanceof mt&&a.children.length&&(!s||a.pointChildrenEnabled)&&(o=a.getNodeAtPoint(t,e,i,s)),o){if(!i)return o;o instanceof Array&&(r=r.concat(o))}else if(a.hitTestPoint(t,e)){if(!i)return a;r.push(a)}}return i&&r.length?r:null}}class gt{constructor(t){this.offset=null,t&&this.init(t)}init(t){return this.image=t.image||this.image,t.rect&&(this.rect=t.rect)||(this.rect=[0,0,this.image.width,this.image.height]),t.offset&&(this.offset=t.offset),this}}let yt={x:0,y:0,rotate:0,alpha:1,vx:0,vy:0,ax:0,ay:0,scaleFix:1,vScaleFix:0,vRotate:0,vAlpha:0,life:1};class xt extends _t{constructor(t={}){super(t),this._died=!1,this._time=0,this.name=et(t,"name")||Q("Particle"),this.system=et(t,"system")||null,this.init(t)}static create(t){let e;return xt.diedParticles.length>0?(e=xt.diedParticles.pop(),e.init(t)):e=new xt(t),e}renderStartDraw(t,e){if(this.system&&e&&e.deltaTime){if(this._died)return!1;let t=.001*e.deltaTime;if(this._time+=t,this.vx+=(this.ax+this.system.gx)*t,this.vy+=(this.ay+this.system.gy)*t,this.x+=this.vx*t,this.y+=this.vy*t,this.scaleFix+=this.vScaleFix,this.scale[0]=this.scale[1]=this.scaleFix,this.rotate+=this.vRotate,this._time>.1&&(this.alpha+=this.vAlpha),this._time>=this.life||this.alpha<=0)return this.destroy(),!1}return super.renderStartDraw(t,e)}init(t){if(t.system){this.system=t.system,this._died=!1,this._time=0,this.alpha=1;for(let e in yt)this[e]=it(void 0===t[e]?yt[e]:t[e],t[e+"Var"]);if(this.x+=this.system.emitterX,this.y+=this.system.emitterY,t.image&&t.frames){let e,i=t.frames;e=i&&i.length?i[w.random()*i.length>>0]:[0,0,t.image.width,t.image.height],this.drawable=this.drawable||new gt,this.width=e[2],this.height=e[3],this.drawable.rect=e,this.drawable.image=t.image,t.anchor&&void 0!==t.anchor[0]&&void 0!==t.anchor[1]&&(this.anchor[0]=t.anchor[0]*e[2],this.anchor[1]=t.anchor[1]*e[3])}}}destroy(){this._died=!0,this.alpha=0,this.removeParent(),xt.diedParticles.push(this)}}xt.diedParticles=[];function bt(t,e){let i={image:t.image,rect:t.rect};return e&&(i.name=e.name||null,i.duration=e.duration||0,i.stop=!!e.stop,i.next=void 0!==e.next?e.next:null,i.callback=e.callback||null),i}class vt extends _t{constructor(t={}){super(t),this.name=et(t,"name")||Q("Bitmap"),this.drawable=new gt,this.setImage(t)}setImage(t){if(this.drawable){let e=this.drawable.init(t);t.rect?(this.width=t.rect[2],this.height=t.rect[3]):this.width&&this.height||(this.width=e.rect[2],this.height=e.rect[3])}return this}}class wt extends mt{constructor(t={}){super(t),this.name=et(t,"name")||Q("BitmapText"),this.glyphs=et(t,"glyphs")||null,this.text=et(t,"text")||"",this.letterSpacing=et(t,"letterSpacing")||0,this.textAlign=et(t,"textAlign")||"left";let e=this.text+"";e&&(this.text="",this.setText(e)),this.pointChildrenEnabled=!1}static createGlyphs(t,e,i,s){i=i||t.length,s=s||1;let r={},n=e.width/i,h=e.height/s;for(let s=0;s<t.length;s++)r[t.charAt(s)]={image:e,rect:[n*(s%i),h*w.floor(s/i),n,h]};return r}_createBitmap(t){let e;return wt._pool.length?(e=wt._pool.pop(),e.setImage({image:t.image,rect:t.rect})):e=new vt({image:t.image,rect:t.rect}),e}_releaseBitmap(t){wt._pool.push(t)}setText(t){let e=this,i=t.toString(),s=i.length;if(e.text===i)return this;let r,n,h=0,o=0;e.text=i;for(let t=0;t<s;t++)r=e.glyphs&&e.glyphs[i.charAt(t)],r&&(e.children[t]?(n=e.children[t],n.setImage({image:r.image,rect:r.rect})):(n=e._createBitmap(r),e.addChild(n)),n.x=h+(h>0?e.letterSpacing:0),h=n.x+r.rect[2],o=w.max(o,r.rect[3]));for(let t=e.children.length-1;t>=s;t--)e._releaseBitmap(e.children[t]),e.children[t].removeParent();return e.width=h,e.height=o,this.setTextAlign(),e}setTextAlign(t){switch(this.textAlign=t||this.textAlign,this.textAlign){case"center":this.anchor[0]=.5*this.width;break;case"right":this.anchor[0]=this.width;break;default:this.anchor[0]=0}return this}hasGlyphs(t){let e=this.glyphs;if(!e)return!1;t=t.toString();for(let i=0;i<t.length;i++)if(!e[t.charAt(i)])return!1;return!0}}wt._pool=[];class St extends _t{constructor(t={}){super(t),this.name=et(t,"name")||Q("Button"),this.upState=et(t,"upState")||null,this.overState=et(t,"overState")||null,this.downState=et(t,"downState")||null,this.disabledState=et(t,"disabledState")||null,this.state=et(t,"state")||"",this.enabled=et(t,"enabled")||!0,this.drawable=new gt(t),this.pointerCursor="pointer",this.setState(St.UP)}emit(t){if(!this.enabled)return!1;switch(t.type){case"mousedown":case"touchstart":case"touchmove":this.setState(St.DOWN);break;case"mouseover":case"touchover":this.setState(St.OVER);break;case"mouseup":case"touchend":this.overState?this.setState(St.OVER):this.upState&&this.setState(St.UP);break;case"touchout":case"mouseout":this.setState(St.UP)}return super.emit(t)}setEnabled(t){return this.enabled!==t&&(t?this.setState(St.UP):this.setState(St.DISABLED)),this}setState(t){if(this.state!==t){let e;switch(this.state=t,this.pointerEnabled=this.enabled=t!==St.DISABLED,t){case St.UP:e=this.upState;break;case St.OVER:e=this.overState;break;case St.DOWN:e=this.downState;break;case St.DISABLED:e=this.disabledState}e&&this.drawable&&this.drawable.init(e)}return this}}St.UP="up",St.OVER="over",St.DOWN="down",St.DISABLED="disabled";let Tt=G("canvas").getContext("2d");class kt extends _t{constructor(t={}){super(t),this._textWidth=0,this._textHeight=0,this.name=et(t,"name")||Q("Text"),this.text=et(t,"text")||"",this.color=et(t,"color")||"#000",this.textAlign=et(t,"textAlign")||"left",this.textVAlign=et(t,"textVAlign")||"top",this.outline=et(t,"outline")||!1,this.lineSpacing=et(t,"lineSpacing")||0,this.maxWidth=et(t,"maxWidth")||200,this.font=et(t,"font")||"12px arial",this._fontHeight=kt.measureFontHeight(this.font)}static measureFontHeight(t){let e,i=v,s=G("div",{style:{font:t,position:"absolute"},innerHTML:"M"});return i.appendChild(s),e=s.offsetHeight,i.removeChild(s),e}get textWidth(){return this._textWidth}get textHeight(){return this._textHeight}_drawTextLine(t,e,i){let s=0,r=this.width;switch(this.textAlign){case"center":s=r>>1;break;case"right":case"end":s=r}this.outline?t.strokeText(e,s,i):t.fillText(e,s,i)}_draw(t){let e=this;if(!e.text)return;let i,s=e.text.split(/\r\n|\r|\n|<br(?:[ \/])*>/),r=0,n=0,h=e._fontHeight+e.lineSpacing,o=[];t.font=e.font,t.textAlign=e.textAlign,t.textBaseline="top";for(let a=0;a<s.length;a++){i=s[a];let l=t.measureText(i).width;if(l<=e.maxWidth){o.push({text:i,y:n}),r<l&&(r=l),n+=h;continue}let u,d,c="",p=0;for(let s=0,a=i.length;s<a;s++)d=i[s],u=t.measureText(c+d).width,u>e.maxWidth?(o.push({text:c,y:n}),r<p&&(r=p),n+=h,c=d):(p=u,c+=d),s===a-1&&(o.push({text:c,y:n}),c!==d&&r<u&&(r=u),n+=h)}e._textWidth=r,e._textHeight=n,e.width||(e.width=r),e.height||(e.height=n);let a=0;switch(e.textVAlign){case"middle":a=e.height-e._textHeight>>1;break;case"bottom":a=e.height-e._textHeight}e.background&&(t.fillStyle=e.background,t.fillRect(0,0,e.width,e.height)),e.outline?t.strokeStyle=e.color:t.fillStyle=e.color;for(let s=0;s<o.length;s++)i=o[s],e._drawTextLine(t,i.text,a+i.y)}renderDraw(t,e){this._draw(t.context)}setFont(t){return this.font!==t&&(this.font=t,this._fontHeight=kt.measureFontHeight(t)),this}}class Ct extends dt{constructor(t={}){super(t),this.type=et(t,"type")||"",this.target=et(t,"target")||null,this.parentEvent=et(t,"parentEvent")||null,this.key=et(t,"key")||"",this.keys=et(t,"keys")||[],this.splitKeys=et(t,"splitKeys")||"",this.keyDownKeys=et(t,"keyDownKeys")||[],this.keyDownSplitKeys=et(t,"keyDownSplitKeys")||"",this.isRepeat=et(t,"isRepeat")||!1}get isShift(){return-1!==this.keys.indexOf("Shift")}isCtrl(){return-1!==this.keys.indexOf("Control")}isAlt(){return-1!==this.keys.indexOf("Alt")}isMeta(){return-1!==this.keys.indexOf("Meta")}isKeys(t){return-1!==this.keys.indexOf(t)}isKeyDown(){return 0===this.keyDownKeys.length}isKeyDownKeys(t){return-1!==this.keyDownKeys.indexOf(t)}}class At{constructor(t){this._keysDown=[],this._reg=[],this.splitKey="+",this.stage=t,this._domEvent=this._domEvent.bind(this),this._domClearKey=this._domClearKey.bind(this)}get reg(){return this._reg}_domEvent(t){let e=this._keysDown.slice(0),i={type:t.type,key:t.key,isRepeat:t.repeat};if("keydown"===i.type)-1===this._keysDown.indexOf(i.key)&&(this._keysDown.push(i.key),e=this._keysDown.slice(0));else if("keyup"===i.type){let t=this._keysDown.indexOf(i.key);t>-1&&this._keysDown.splice(t,1)}i.keys=e,i.splitKeys=i.keys.join(this.splitKey),i.keyDownKeys=this._keysDown.slice(0),i.keyDownSplitKeys=i.keyDownKeys.join(this.splitKey);for(let e=0;e<this._reg.length;e++){let s=this._reg[e];s.emitFn(i.type,(function(e){let r=c(i);return r.target=s,r.parentEvent=t,new Ct(r)})),s.emitFn(i.type+" "+i.splitKeys,(function(e){let r=c(i);return r.type=r.type+" "+r.splitKeys,r.target=s,r.parentEvent=t,new Ct(r)}))}}_domClearKey(t){this._keysDown=[]}reset(t){0!==t.length?this._reg=t:this._reg=[]}has(t){return-1!==this.get(t)}get(t){return this._reg.indexOf(t)}add(t){return t instanceof Array?this._reg.concat(t):this._reg.push(t),this}set(t,e){let i=t instanceof _t?this._reg.indexOf(t):t;return(i>=0||i<this._reg.length)&&(this._reg[i]=e),this}remove(t){let e=t instanceof _t?this._reg.indexOf(t):t;return(e>=0||e<this._reg.length)&&this._reg.splice(e,1),this}enable(t=!0){let e=["keydown","keyup"];for(let i=0;i<e.length;i++)q(y,e[i],this._domEvent,t);q(y,"focus",this._domClearKey,t),q(y,"blur",this._domClearKey,t)}}class Ot{constructor(t={}){this.renderType="canvas",this.layers=new mt,this.blendMode="source-over",this.viewport=null,this.element=et(t,"element")||G("canvas"),this.context=this.element.getContext("2d");let e=this.updateViewport();this.layers.scale=et(t,"scale",1)||[1,1],this.resize(et(t,"width")||e&&e.width||480,et(t,"height")||e&&e.height||320)}get height(){return this.layers.height}get width(){return this.layers.width}get scale(){return this.layers.scale}set height(t){this.resize(this.width,t)}set width(t){this.resize(t,this.height)}set scale(t){this.layers.scale=t,this.resize(this.width,this.height)}updateViewport(){let t=this.element;return this.viewport=t.parentNode?X(t):null,this.viewport}resize(t,e){this.width===t&&this.height===e||(this.element.width=this.layers.width=t,this.element.height=this.layers.height=e,this.element.style.width=t*this.layers.scale[0]+"px",this.element.style.height=e*this.layers.scale[1]+"px",this.updateViewport())}startDraw(t){return!!(t.visible&&t.alpha>0)&&(t===this.layers&&this.clear(0,0,t.width,t.height),t.blendMode!==this.blendMode&&(this.context.globalCompositeOperation=this.blendMode=t.blendMode),this.context.save(),!0)}transform(t){let e=this.context,i=t.getTransformMatrix();t.mask&&(t.mask.render(this),e.clip()),e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty),t.alpha>0&&(e.globalAlpha*=t.alpha)}draw(t){let e=this.context,i=t.background,s=t.width,r=t.height;i&&(e.fillStyle=i,e.fillRect(0,0,s,r));let n=t.drawable,h=n&&n.image;if(n&&h){let i=n.rect,o=i[2],a=i[3];if(!o||!a)return;if(s||r||(s=t.width=o,r=t.height=a),n.offset){let t=n.offset[0]||0,i=n.offset[1]||0;e.translate(t-.5*o,i-.5*a)}e.drawImage(h,i[0],i[1],o,a,0,0,s,r)}}endDraw(){this.context.restore()}clear(t,e,i,s){this.context.clearRect(t,e,i,s)}}class Pt{constructor(t,e,i,s){this.set(t,e,i,s)}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}get topLeft(){return new ut(this.left,this.top)}get bottomRight(){return new ut(this.right,this.bottom)}set top(t){this.height+=this.y-t,this.y=t}set bottom(t){this.height=t-this.y}set left(t){this.width+=this.x-t,this.x=t}set right(t){this.width=t-this.x}set topLeft(t){this.top=t.y,this.left=t.x}set bottomRight(t){this.bottom=t.y,this.right=t.x}set(t=0,e=0,i=0,s=0){return this.x=t,this.y=e,this.width=i,this.height=s,this}contains(t,e){let i=!1;return t instanceof ut?i=this.contains(t.x,t.y):void 0!==t&&void 0!==e&&(i=t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height),i}equal(t){return t instanceof Pt&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}toArray(){return[this.x,this.y,this.width,this.height]}}var Et;let It=null;try{S&&(It=new S)}catch(t){}let Rt=Et=class{constructor(t={}){this._loaded=!1,this._playing=!1,this._startTime=0,this._offset=0,this._duration=0,this._volume=1,this._muted=!1,at.CTOR(this),this.data=t.data,this.loop=et(t,"loop")||!1,this.autoPlay=et(t,"autoPlay")||!1,It&&(this._context=It,this._gainNode=this._context.createGain(),this._gainNode.connect(this._context.destination))}get loaded(){return this._loaded}get playing(){return this._playing}get duration(){return this._duration}get volume(){return this._volume}get muted(){return this._muted}set volume(t){this._volume!==t&&(this._gainNode.gain.value=this._volume=t)}set muted(t){this._muted!==t&&(this._muted=t,this._gainNode.gain.value=t?0:this._volume)}_doPlay(){let t=this;this._audioNode&&(this._audioNode.onended=null,this._audioNode.disconnect(0)),this._audioNode=this._context.createBufferSource(),this._gainNode.gain.value=this._muted?0:this._volume,this._startTime=this._context.currentTime,this._audioNode.buffer=this._buffer,this._audioNode.onended=function(){t._playing=!1,t._offset=0,t.emit(new dt({type:Et.END,target:t})),t.loop&&t._doPlay()},this._audioNode.connect(this._gainNode),this._audioNode.start(0,this._offset),this._playing=!0}load(){let t=this;return this._context.decodeAudioData(this.data,(function(e){t._buffer=e,t._loaded=!0,t._duration=e.duration,t.emit(new dt({type:Et.LOAD,target:t})),t.autoPlay&&t._doPlay()}),(function(){t.emit(new dt({type:Et.ERROR,target:t}))})),this}play(){return this._loaded?this._doPlay():(this.autoPlay=!0,this.load()),this}pause(){return this._audioNode&&this._playing&&(this._audioNode.stop(0),this._audioNode.disconnect(0),this._offset+=this._context.currentTime-this._startTime,this._playing=!1),this}stop(){return this._audioNode&&(this._audioNode.stop(0),this._audioNode.disconnect(0),this._offset=0,this._playing=!1),this}};Rt.isSupported=null!==It,Rt.LOAD="load",Rt.ERROR="error",Rt.END="end",Rt=Et=ot([Z([at])],Rt);class Dt{constructor(t={}){let e=t.url,i=et(t,"data")||"",s=et(t,"method")||"get",r=et(t,"async")||!0,n=et(t,"responseType")||null,h=et(t,"timeout")||0,o=et(t,"withCredentials")||!1,a=et(t,"headers")||{},l=et(t,"mime")||"text/xml",u=et(t,"onabort")||null,d=et(t,"onerror")||null,c=et(t,"onload")||null,p=et(t,"onloadend")||null,f=et(t,"onloadstart")||null,_=et(t,"onprogress")||null,m=et(t,"onupload")||null,g=et(t,"ontimeout")||null;if(this.xhr=new XMLHttpRequest,"get"===s.toLowerCase()){let t=Object.keys(i).map((t=>t+"="+i[t])).join("&");e+=e.indexOf("?")<0?"?"+t:"&"+t}this.xhr.open(s,e,r);for(let t in a)this.xhr.setRequestHeader(t,a[t]);this.xhr.overrideMimeType(l),n&&(this.xhr.responseType=n),this.xhr.timeout=h,this.xhr.withCredentials=o,u&&(this.xhr.onabort=u.bind(this)),d&&(this.xhr.onerror=d.bind(this)),c&&(this.xhr.onload=c.bind(this)),p&&(this.xhr.onloadend=p.bind(this)),f&&(this.xhr.onloadstart=f.bind(this)),_&&(this.xhr.onprogress=_.bind(this)),m&&(this.xhr.upload.onprogress=m.bind(this)),g&&(this.xhr.ontimeout=g.bind(this)),this.xhr.send(i)}get readyState(){return this.xhr.readyState}get response(){return this.xhr.response}get responseType(){return this.xhr.responseType}get responseText(){return this.xhr.responseText}get responseURL(){return this.xhr.responseURL}get responseXML(){return this.xhr.responseXML}get status(){return this.xhr.status}get statusText(){return this.xhr.statusText}abort(){this.xhr.abort()}responseHeaders(){let t={},e=this.xhr.getAllResponseHeaders().split("\n");for(let i of e){let e=i.indexOf(":"),s=i.slice(0,e).trim(),r=i.slice(e+1).trim();t[s]?(Array.isArray(t[s])||(t[s]=[t[s]]),t[s].push(r)):s&&(t[s]=r)}return t}}var Ft;function Lt(t,e){let i=new Image;t.crossOrigin&&(i.crossOrigin="Anonymous"),i.onload=function(t){let i=t.target;i.onload=i.onerror=i.onabort=null,e("load",i)},i.onerror=i.onabort=function(t){let i=t.target;i.onload=i.onerror=i.onabort=null,e("error",t)},i.src=t.src+(t.noCache?(-1===t.src.indexOf("?")?"?":"&")+"t="+st():"")}function Nt(t,e){let i=t.src,s=document.createElement("script");t.noCache&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+st()),t.id&&(s.id=t.id),s.type="text/javascript",s.async=!0,s.src=i,s.onload=function(t){let i=t.target;i.onload=i.onerror=null,e("load",i)},s.onerror=function(t){let i=t.target;i.onload=i.onerror=null,e("error",t)},document.getElementsByTagName("head")[0].appendChild(s)}function Mt(t,e){let i=t.src;t.noCache&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+st()),new Dt({url:i,responseType:"arraybuffer",onload:function(t){let i=t.target;i.onload=i.onerror=null,e("load",i.response)},onerror:function(t){let i=t.target;i.onload=i.onerror=null,e("error",t)}})}class zt extends dt{constructor(t={}){super(t),this.type=et(t,"type")||"",this.source=et(t,"source")||null}}let Ut=Ft=class{constructor(t={}){this._source=[],this._currentIndex=-1,this._connections=0,this._loaded=0,this.maxConnections=2,at.CTOR(this),t&&this.add(t)}get loaded(){return this._loaded}get total(){return this._source.length}_getLoader(t){if(!t.loader)switch(t.type){case"img":t.loader=Lt;break;case"js":t.loader=Nt;break;case"audio":t.loader=Mt}return t.loader}_loadNext(){let t=this,e=t._source;if(t._loaded>=e.length)t.emit(new zt({type:Ft.COMPLETE,target:t}));else if(t._currentIndex<e.length-1&&t._connections<t.maxConnections){let i=e[++t._currentIndex],s=t._getLoader(i),r=function(e,s){e!==Ft.LOAD&&e!==Ft.ERROR||(i.loaded=e===Ft.LOAD,i.content=s,t._connections--,t._loaded++,t.emit(new zt({type:e,target:t,source:[i]})),t._loadNext())};s&&t._connections++,t._loadNext(),s&&s(i,r)}}start(){return this._loadNext(),this}add(t){return this._source=this._source.concat(t),this}getSource(t){let e=this._source;for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t||s.src===t)return s}return null}removeContent(t){let e=this._source;for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t||s.src===t)return e.splice(i,1),!0}return!1}};Ut.COMPLETE="complete",Ut.LOAD="load",Ut.ERROR="error",Ut=Ft=ot([Z([at])],Ut);let Bt=w.PI,jt=.5*Bt,Ht=w.sin,Vt=w.cos,Wt=w.pow,Kt=w.sqrt,qt=w.asin,Gt={linear:function(t){return t},quad:{easeIn:function(t){return t*t},easeOut:function(t){return-t*(t-2)},easeInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},cubic:{easeIn:function(t){return t*t*t},easeOut:function(t){return--t*t*t+1},easeInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},quart:{easeIn:function(t){return t*t*t*t},easeOut:function(t){return-(--t*t*t*t-1)},easeInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},quint:{easeIn:function(t){return t*t*t*t*t},easeOut:function(t){return(t-=1)*t*t*t*t+1},easeInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},sine:{easeIn:function(t){return 1-Vt(t*jt)},easeOut:function(t){return Ht(t*jt)},easeInOut:function(t){return-.5*(Vt(Bt*t)-1)}},expo:{easeIn:function(t){return 0===t?0:Wt(2,10*(t-1))},easeOut:function(t){return 1===t?1:1-Wt(2,-10*t)},easeInOut:function(t){return 0===t||1===t?t:(t*=2)<1?.5*Wt(2,10*(t-1)):.5*(2-Wt(2,-10*(t-1)))}},circ:{easeIn:function(t){return-(Kt(1-t*t)-1)},easeOut:function(t){return Kt(1- --t*t)},easeInOut:function(t){return(t/=.5)<1?-.5*(Kt(1-t*t)-1):.5*(Kt(1-(t-=2)*t)+1)}},elastic:{props:{a:1,p:.4,s:.1,config:function(t,e){Gt.elastic.props.a=t,Gt.elastic.props.p=e,Gt.elastic.props.s=e/(2*Bt)*qt(1/t)||0}},easeIn:function(t){return-Gt.elastic.props.a*Wt(2,10*(t-=1))*Ht((t-Gt.elastic.props.s)*(2*Bt)/Gt.elastic.props.p)},easeOut:function(t){return Gt.elastic.props.a*Wt(2,-10*t)*Ht((t-Gt.elastic.props.s)*(2*Bt)/Gt.elastic.props.p)+1},easeInOut:function(t){return(t*=2)<1?Gt.elastic.props.a*Wt(2,10*(t-=1))*Ht((t-Gt.elastic.props.s)*(2*Bt)/Gt.elastic.props.p)*-.5:Gt.elastic.props.a*Wt(2,-10*(t-=1))*Ht((t-Gt.elastic.props.s)*(2*Bt)/Gt.elastic.props.p)*.5+1}},bounce:{easeIn:function(t){return 1-Gt.bounce.easeOut(1-t)},easeOut:function(t){return(t/=1)<.36364?7.5625*t*t:t<.72727?7.5625*(t-=.54545)*t+.75:t<.90909?7.5625*(t-=.81818)*t+.9375:7.5625*(t-=.95455)*t+.984375},easeInOut:function(t){return t<.5?.5*Gt.bounce.easeIn(2*t):.5*Gt.bounce.easeOut(2*t-1)+.5}},back:{props:{o:1.70158,s:2.59491,config:function(t){Gt.back.props.o=t,Gt.back.props.s=1.525*t}},easeIn:function(t){return t*t*((Gt.back.props.o+1)*t-Gt.back.props.o)},easeOut:function(t){return(t-=1)*t*((Gt.back.props.o+1)*t+Gt.back.props.o)+1},easeInOut:function(t){return(t*=2)<1?t*t*((Gt.back.props.s+1)*t-Gt.back.props.s)*.5:.5*((t-=2)*t*((Gt.back.props.s+1)*t+Gt.back.props.s)+2)}}},Xt=w.PI,Yt=w.sin,Jt=w.cos,Qt=w.abs,$t=w.pow,Zt=w.sqrt,te=w.asin,ee={linear:(t,e,i,s)=>i*t/s+e,quad:{easeIn:(t,e,i,s)=>i*(t/=s)*t+e,easeOut:(t,e,i,s)=>-i*(t/=s)*(t-2)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},cubic:{easeIn:(t,e,i,s)=>i*(t/=s)*t*t+e,easeOut:(t,e,i,s)=>i*((t=t/s-1)*t*t+1)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},quart:{easeIn:(t,e,i,s)=>i*(t/=s)*t*t*t+e,easeOut:(t,e,i,s)=>-i*((t=t/s-1)*t*t*t-1)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},quint:{easeIn:(t,e,i,s)=>i*(t/=s)*t*t*t*t+e,easeOut:(t,e,i,s)=>i*((t=t/s-1)*t*t*t*t+1)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},sine:{easeIn:(t,e,i,s)=>t===s?e+i:-i*Jt(t/s*(Xt/2))+i+e,easeOut:(t,e,i,s)=>i*Yt(t/s*(Xt/2))+e,easeInOut:(t,e,i,s)=>-i/2*(Jt(Xt*t/s)-1)+e},expo:{easeIn:(t,e,i,s)=>0===t?e:i*$t(2,10*(t/s-1))+e,easeOut:(t,e,i,s)=>t===s?e+i:i*(1-$t(2,-10*t/s))+e,easeInOut:(t,e,i,s)=>0===t?e:t===s?e+i:(t/=s/2)<1?i/2*$t(2,10*(t-1))+e:i/2*(2-$t(2,-10*--t))+e},circ:{easeIn:(t,e,i,s)=>-i*(Zt(1-(t/=s)*t)-1)+e,easeOut:(t,e,i,s)=>i*Zt(1-(t=t/s-1)*t)+e,easeInOut:(t,e,i,s)=>(t/=s/2)<1?-i/2*(Zt(1-t*t)-1)+e:i/2*(Zt(1-(t-=2)*t)+1)+e},elastic:{easeIn(t,e,i,s){let r=1.70158,n=0,h=i;return 0===t?e:1==(t/=s)?e+i:(n||(n=.3*s),h<Qt(i)?(h=i,r=n/4):r=n/(2*Xt)*te(i/h),-h*$t(2,10*(t-=1))*Yt(2*Xt*(t*s-r)/n)+e)},easeOut(t,e,i,s){let r=1.70158,n=0,h=i;return 0===t?e:1==(t/=s)?e+i:(n||(n=.3*s),h<Qt(i)?(h=i,r=n/4):r=n/(2*Xt)*te(i/h),h*$t(2,-10*t)*Yt(2*Xt*(t*s-r)/n)+i+e)},easeInOut(t,e,i,s){let r=1.70158,n=0,h=i;return 0===t?e:2==(t/=s/2)?e+i:(n||(n=s*(.3*1.5)),h<Qt(i)?(h=i,r=n/4):r=n/(2*Xt)*te(i/h),t<1?h*$t(2,10*(t-=1))*Yt(2*Xt*(t*s-r)/n)*-.5+e:h*$t(2,-10*(t-=1))*Yt(2*Xt*(t*s-r)/n)*.5+i+e)}},bounce:{easeIn:(t,e,i,s)=>i-ee.bounce.easeOut(s-t,0,i,s)+e,easeOut:(t,e,i,s)=>(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,easeInOut:(t,e,i,s)=>t<s/2?.5*ee.bounce.easeIn(2*t,0,i,s)+e:.5*ee.bounce.easeOut(2*t-s,0,i,s)+.5*i+e},back:{easeIn:(t,e,i,s,r=1.70158)=>t===s?e+i:i*(t/=s)*t*((r+1)*t-r)+e,easeOut:(t,e,i,s,r=1.70158)=>0===t?e:i*((t=t/s-1)*t*((r+1)*t+r)+1)+e,easeInOut:(t,e,i,s,r=1.70158)=>(t/=s/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e}},ie={x:0,y:0,height:0,width:0,alpha:0,background:"",anchor:[0,0],rotate:0,scale:[0,0],skew:[0,0],transform:[1,0,0,1,0,0]};class se{constructor(t={}){this._startTime=0,this._seekTime=0,this._pausedTime=0,this._pausedStartTime=0,this._reverseFlag=1,this._repeatCount=0,this._next=null,this._isStart=!1,this._isComplete=!1,this.time=0,this.target=t.target,this.fromProps=et(t,"fromProps",2)||null,this.toProps=et(t,"toProps",2)||null,this.duration=et(t,"duration")||1e3,this.delay=et(t,"delay")||0,this.paused=et(t,"paused")||!1,this.loop=et(t,"loop")||!1,this.reverse=et(t,"reverse")||!1,this.repeat=et(t,"repeat")||0,this.repeatDelay=et(t,"repeatDelay")||0,this.ease=et(t,"ease")||Gt.linear,this.onStart=et(t,"onStart")||null,this.onUpdate=et(t,"onUpdate")||null,this.onComplete=et(t,"onComplete")||null,this.onDestroyed=et(t,"onDestroyed")||null}static add(t){let e=se._tweens;return-1===e.indexOf(t)&&e.push(t),se}static fromto(t){let e=new se(t);return e.start(),e}static remove(t){let e=se._tweens;if(t instanceof se){let i=e.indexOf(t);i>-1&&e.splice(i,1)}else for(let i=0;i<e.length;i++)e[i].target===t&&(e.splice(i,1),i--);return se}static removeAll(){return se._tweens.length=0,se}static tick(){let t=se._tweens;for(let e=0;e<t.length;e++){let i=t[e];i&&i.update(st())&&(t.splice(e,1),e--,i.onDestroyed&&i.onDestroyed.call(i))}return se}get isStart(){return this._isStart}get isComplete(){return this._isComplete}_renderFromTo(t){let e=this.target,i=this.fromProps,s=this.toProps;for(let r in i)e[r]=i[r]+(s[r]-i[r])*t}setProps(t=null,e=null){let i=t||e;if(i){let s=t||this.target,r=e||this.target,n=c(ie,!0);this.fromProps={},this.toProps={};for(let t in i)this.toProps[t]=r[t]||n[t],this.target[t]=this.fromProps[t]=s[t]||n[t]}return this}start(){return this._startTime=st()+this.delay,this._seekTime=0,this._pausedTime=0,this._reverseFlag=1,this._repeatCount=0,this.paused=!1,this._isStart=!1,this._isComplete=!1,se.add(this),this}stop(){return se.remove(this),this}pause(){return this.paused=!0,this._pausedStartTime=st(),this}resume(){return this.paused=!1,this._pausedStartTime&&(this._pausedTime+=st()-this._pausedStartTime),this._pausedStartTime=0,this}seek(t,e=!1){let i=st();return this._startTime=i,this._seekTime=t,this._pausedTime=0,e&&(this.paused=e),this.update(i,!0),se.add(this),this}link(t,e=!1){let i=t.delay,s=this._startTime;return t._startTime=e?s+this.duration+i:s+i,this._next=t,se.remove(t),t}update(t,e=!1){if(this.paused&&!e)return!1;if(this._isComplete)return!0;let i=t-this._startTime-this._pausedTime+this._seekTime;if(i<0)return!1;let s=i/this.duration;s=s<=0?0:s>=1?1:s;let r=this.ease(s);this.reverse&&this._isStart&&(this._reverseFlag<0&&(s=1-s,r=1-r),s<1e-7&&(this.repeat>0&&this._repeatCount++>=this.repeat||0===this.repeat&&!this.loop?this._isComplete=!0:(this._startTime=st(),this._pausedTime=0,this._reverseFlag*=-1))),this._isStart||(this.setProps(this.fromProps,this.toProps),this._isStart=!0,this.onStart&&this.onStart.call(this)),this.time=i,this._renderFromTo(r),this.onUpdate&&this.onUpdate.call(this,r),s>=1&&(this.reverse?(this._startTime=st(),this._pausedTime=0,this._reverseFlag*=-1):this.loop||this.repeat>0&&this._repeatCount++<this.repeat?(this._startTime=st()+this.repeatDelay,this._pausedTime=0):this._isComplete=!0);let n=this._next;return n&&n.time<=0&&(n._startTime>0&&n._startTime<=t?(n._renderFromTo(s),n.time=i,se.add(n)):this._isComplete&&(n._startTime<0||n._startTime>t)&&n.start()),!!this._isComplete&&(this.onComplete&&this.onComplete.call(this),!0)}}se._tweens=[];var re={Quickly:m,Global:k,display:{Camera:class{constructor(t={}){this.bound=et(t,"bound",1),this.x=et(t,"x")||0,this.y=et(t,"y")||0,this.width=et(t,"width")||0,this.height=et(t,"height")||0,this.zoom=et(t,"zoom")||1,this.target=et(t,"target")||null,this.deadzone=et(t,"deadzone",1)||null}tick(t){if(this.target){let t,e,i=this.target,s=this.zoom,r=this.deadzone,n={x:i.x*s,y:i.y*s},h=[this.bound[0]*s,this.bound[1]*s,this.bound[2]*s-this.width,this.bound[3]*s-this.height];r?(t=w.min(w.max(n.x-this.x,r[0]),r[0]+r[2]),e=w.min(w.max(n.y-this.y,r[1]),r[1]+r[3])):(t=this.width/2,e=this.height/2),this.x=n.x-t,this.y=n.y-e,h&&(this.x=w.min(w.max(this.x,h[0]),h[0]+h[2]),this.y=w.min(w.max(this.y,h[1]),h[1]+h[3]))}}follow(t){this.target=t,this.tick()}},Node:_t,Container:mt,Particle:xt,ParticleSystem:class extends mt{constructor(t={}){super(t),this._isRun=!1,this._currentRunTime=0,this._emitTime=0,this._totalRunTime=0,this.name=et(t,"name")||Q("ParticleSystem"),this.gx=et(t,"gx")||0,this.gy=et(t,"gy")||0,this.emitterX=et(t,"emitterX")||0,this.emitterY=et(t,"emitterY")||0,this.emitTime=et(t,"emitTime")||.2,this.emitTimeVar=et(t,"emitTimeVar")||0,this.emitNum=et(t,"emitNum")||10,this.emitNumVar=et(t,"emitNumVar")||0,this.totalTime=et(t,"totalTime")||1/0,this.particle=et(t,"particle")||{},this.particle.system=this}renderStartDraw(t,e){if(this._isRun&&e&&e.deltaTime){let t=.001*e.deltaTime;if((this._currentRunTime+=t)>=this._emitTime){this._currentRunTime=0,this._emitTime=it(this.emitTime,this.emitTimeVar);for(let t=0;t<it(this.emitNum,this.emitNumVar)>>0;t++)this.addChild(xt.create(this.particle))}(this._totalRunTime+=t)>=this.totalTime&&this.stop()}return super.renderStartDraw(t,e)}start(){this.stop(!0),this._isRun=!0,this._currentRunTime=0,this._totalRunTime=0,this._emitTime=it(this.emitTime,this.emitTimeVar)}stop(t){if(this._isRun=!1,t)for(let t=this.children.length-1;t>=0;t--)this.children[t].destroy()}reset(t){tt(this,[t]),this.particle.system=this}},Drawable:gt,TextureAtlas:class{constructor(t){this._frames=null,this._sprites=null,this._frames=function(t){let e=t.frames,i=[];if(!e)return null;if(e instanceof Array)for(let s=0;s<e.length;s++)i[s]={image:t.image,rect:e[s]};else{let s=e.frameWidth,r=e.frameHeight,n=t.width/s|0,h=t.height/r|0,o=e.numFrames||n*h;for(let e=0;e<o;e++)i[e]={image:t.image,rect:[e%n*s,(e/n|0)*r,s,r]}}return i}(t),this._frames&&(this._sprites=function(t,e){let i=t.sprites,s={};if(!i)return null;for(let t in i){let r=[],n=i[t];if("number"==typeof n)r=bt(e[n]);else if(n instanceof Array)for(let t=0;t<n.length;t++){let i=n[t];r[t]="number"==typeof i?bt(e[i]):bt(e[i.framesIndex],i)}else for(let t=n.from;t<=n.to;t++)r[t-n.from]=bt(e[t],n[t]);s[t]=r}return s}(t,this._frames))}getFrame(t){let e=this._frames;return e&&e[t]}getSprite(t){let e=this._sprites;return e&&e[t]}},Bitmap:vt,BitmapText:wt,Button:St,Graphics:class extends _t{constructor(t={}){super(t),this._actions=[],this._hasStroke=!1,this._hasFill=!1,this.name=et(t,"name")||Q("Graphics"),this.lineWidth=et(t,"lineWidth")||1,this.lineAlpha=et(t,"lineAlpha")||1,this.lineCap=et(t,"lineCap")||null,this.lineJoin=et(t,"lineJoin")||null,this.miterLimit=et(t,"miterLimit")||10,this.strokeStyle=et(t,"strokeStyle")||"0",this.fillStyle=et(t,"fillStyle")||"0",this.fillAlpha=et(t,"fillAlpha")||0}get hasStroke(){return this._hasStroke}get hasFill(){return this._hasFill}_getSVGParams(t){let e=t.substring(1).replace(/[\s]+$|^[\s]+/g,"").split(/[\s]+/);0===e[0].length&&e.shift();for(let t=0;t<e.length;t++)e[t]=parseFloat(e[t]);return e}_convertToAbsolute(t,e){for(let i=0;i<e.length;i++)e[i]+=i%2==0?t.x:t.y}_setCurrentPoint(t,e,i){t.x=e,t.y=i}_getReflectionPoint(t,e){return{x:2*t.x-e.x,y:2*t.y-e.y}}_addAction(t){return this._actions.push(t),this}renderDraw(t,e){let i=t.context,s=this._actions,r=i;i.beginPath();for(let t=0;t<s.length;t++){let e=s[t],n=e[0],h=e.length>1?e.slice(1):null;"function"==typeof r[n]?r[n].apply(i,h):r[n]=e[1]}}lineStyle(t=1,e="0",i=1,s,r,n){return this._addAction(["lineWidth",this.lineWidth=t]),this._addAction(["strokeStyle",this.strokeStyle=e]),this._addAction(["lineAlpha",this.lineAlpha=i]),void 0!==s&&this._addAction(["lineCap",this.lineCap=s]),void 0!==r&&this._addAction(["lineJoin",this.lineJoin=r]),void 0!==n&&this._addAction(["miterLimit",this.miterLimit=n]),this._hasStroke=!0,this}setLineDash(t){return this._addAction(["setLineDash",t])}beginFill(t,e=1){return this._addAction(["fillStyle",this.fillStyle=t]),this._addAction(["fillAlpha",this.fillAlpha=e]),this._hasFill=!0,this}endFill(){return this._hasStroke&&this._addAction(["stroke"]),this._hasFill&&this._addAction(["fill"]),this}beginLinearGradientFill(t,e,i,s,r,n){let h=Tt.createLinearGradient(t,e,i,s);for(let t=0;t<r.length;t++)h.addColorStop(n[t],r[t]);return this._hasFill=!0,this._addAction(["fillStyle",this.fillStyle=h])}beginRadialGradientFill(t,e,i,s,r,n,h,o){let a=Tt.createRadialGradient(t,e,i,s,r,n);for(let t=0;t<h.length;t++)a.addColorStop(o[t],h[t]);return this._hasFill=!0,this._addAction(["fillStyle",this.fillStyle=a])}beginBitmapFill(t,e=""){let i=Tt.createPattern(t,e)||"0";return this._hasFill=!0,this._addAction(["fillStyle",this.fillStyle=i])}beginPath(){return this._addAction(["beginPath"])}closePath(){return this._addAction(["closePath"])}moveTo(t,e){return this._addAction(["moveTo",t,e])}lineTo(t,e){return this._addAction(["lineTo",t,e])}quadraticCurveTo(t,e,i,s){return this._addAction(["quadraticCurveTo",t,e,i,s])}bezierCurveTo(t,e,i,s,r,n){return this._addAction(["bezierCurveTo",t,e,i,s,r,n])}drawRect(t,e,i,s){return this._addAction(["rect",t,e,i,s])}drawRoundRectComplex(t,e,i,s,r,n,h,o){return this._addAction(["moveTo",t+r,e]),this._addAction(["lineTo",t+i-n,e]),this._addAction(["arc",t+i-n,e+n,n,-w.PI/2,0,!1]),this._addAction(["lineTo",t+i,e+s-h]),this._addAction(["arc",t+i-h,e+s-h,h,0,w.PI/2,!1]),this._addAction(["lineTo",t+o,e+s]),this._addAction(["arc",t+o,e+s-o,o,w.PI/2,w.PI,!1]),this._addAction(["lineTo",t,e+r]),this._addAction(["arc",t+r,e+r,r,w.PI,3*w.PI/2,!1]),this}drawRoundRect(t,e,i,s,r){return this.drawRoundRectComplex(t,e,i,s,r,r,r,r)}drawCircle(t,e,i){return this._addAction(["arc",t+i,e+i,i,0,2*w.PI,0])}drawEllipse(t,e,i,s){if(i===s)return this.drawCircle(t,e,i);let r=i/2,n=s/2,h=.5522847498307933,o=h*r,a=h*n;return t+=r,e+=n,this._addAction(["moveTo",t+r,e]),this._addAction(["bezierCurveTo",t+r,e-a,t+o,e-n,t,e-n]),this._addAction(["bezierCurveTo",t-o,e-n,t-r,e-a,t-r,e]),this._addAction(["bezierCurveTo",t-r,e+a,t-o,e+n,t,e+n]),this._addAction(["bezierCurveTo",t+o,e+n,t+r,e+a,t+r,e]),this}drawSVGPath(t){let e,i,s={x:0,y:0},r={x:0,y:0},n=t.replace(/,/g," ").replace(/-/g," -").split(/(?=[a-zA-Z])/);this._addAction(["beginPath"]);for(let t=0;t<n.length;t++){let h=n[t];if(!h.length)continue;let o=h[0],a=o.toUpperCase(),l=this._getSVGParams(h),u=a!==o;switch(a){case"M":u&&this._convertToAbsolute(s,l),this._addAction(["moveTo",l[0],l[1]]),this._setCurrentPoint(s,l[0],l[1]);break;case"L":u&&this._convertToAbsolute(s,l),this._addAction(["lineTo",l[0],l[1]]),this._setCurrentPoint(s,l[0],l[1]);break;case"H":u&&(l[0]+=s.x),this._addAction(["lineTo",l[0],s.y]),s.x=l[0];break;case"V":u&&(l[0]+=s.y),this._addAction(["lineTo",s.x,l[0]]),s.y=l[0];break;case"Z":this._addAction(["closePath"]);break;case"C":u&&this._convertToAbsolute(s,l),this._addAction(["bezierCurveTo",l[0],l[1],l[2],l[3],l[4],l[5]]),r.x=l[2],r.y=l[3],this._setCurrentPoint(s,l[4],l[5]);break;case"S":u&&this._convertToAbsolute(s,l),e="C"===i||"S"===i?this._getReflectionPoint(s,r):s,this._addAction(["bezierCurveTo",e.x,e.y,l[0],l[1],l[2],l[3]]),r.x=l[0],r.y=l[1],this._setCurrentPoint(s,l[2],l[3]);break;case"Q":u&&this._convertToAbsolute(s,l),this._addAction(["quadraticCurveTo",l[0],l[1],l[2],l[3]]),r.x=l[0],r.y=l[1],this._setCurrentPoint(s,l[2],l[3]);break;case"T":u&&this._convertToAbsolute(s,l),e="Q"===i||"T"===i?this._getReflectionPoint(s,r):s,this._addAction(["quadraticCurveTo",e.x,e.y,l[0],l[1]]),r=e,this._setCurrentPoint(s,l[0],l[1])}i=a}return this}clear(){return this._actions.length=0,this.strokeStyle="0",this.lineWidth=1,this.lineAlpha=1,this.lineCap=null,this.lineJoin=null,this.miterLimit=10,this._hasStroke=!1,this._hasFill=!1,this.fillStyle="0",this.fillAlpha=1,this}},Sprite:class extends _t{constructor(t={}){super(t),this._frames=[],this._frameNames={},this._frameElapsed=0,this._firstRender=!0,this._currentFrame=0,this.name=et(t,"name")||Q("Sprite"),this.paused=et(t,"paused")||!1,this.loop=et(t,"loop")||!0,this.timeBased=et(t,"timeBased")||!1,this.interval=et(t,"interval")||1,this.onEnterFrame=et(t,"onEnterFrame")||null,this.drawable=new gt,t.frames&&this.addFrame(t.frames)}get framesCount(){return this._frames?this._frames.length:0}get currentFrame(){return this._currentFrame}_nextFrame(t){let e=this._currentFrame,i=this._frames.length,s=this._frames[e],r=s.duration||this.interval,n=0!==e||this.drawable?this._frameElapsed+(this.timeBased?t:1):0;return this._frameElapsed=n<r?n:0,(s.stop||!this.loop&&e>=i-1)&&this.stop(),this.paused||0!==this._frameElapsed||(null!==s.next&&void 0!==s.next?e=this.getFrameIndex(s.next):e>=i-1?e=0:this.drawable&&e++),e}renderStartDraw(t,e){if(e&&e.deltaTime){let t,i=this._currentFrame;if(this._firstRender?(this._firstRender=!1,t=i):t=this._nextFrame(e.deltaTime),t!==i){let e=this._frames[t].callback;this._currentFrame=t,e&&e.call(this),this.onEnterFrame&&this.onEnterFrame.call(this)}this.drawable&&this.drawable.init(this._frames[t])}return super.renderStartDraw(t,e)}play(){return this.paused=!1,this}stop(){return this.paused=!0,this}goto(t,e){let i=this._frames.length,s=this.getFrameIndex(t);return this._currentFrame=s<0?0:s>=i?i-1:s,this.paused=e,this._firstRender=!0,this}addFrame(t,e){let i=e||this._frames.length;if(t instanceof Array)for(let e=0;e<t.length;e++)this.setFrame(t[e],i+e);else this.setFrame(t,i);return this}getFrame(t){if("number"==typeof t){let e=this._frames;return t<0||t>=e.length?null:e[t]}return this._frameNames[t]}getFrameIndex(t){let e=-1;if("number"==typeof t)e=t;else if("string"==typeof t&&this._frameNames[t])for(let i=0;i<this._frames.length;i++)if(this._frameNames[t]===this._frames[i]){e=i;break}return e}setFrame(t,e){let i=this._frames,s=i.length;return i[e=e<0?0:e>s?s:e]=t,t.name&&(this._frameNames[t.name]=t),(0!==e||this.width)&&this.height||(this.width=t.rect[2],this.height=t.rect[3]),this}setFrameCallback(t,e){let i=this.getFrame(t);return i&&(i.callback=e),this}},Text:kt,Stage:class{constructor(t={}){this.id=p(),this.keyboardDOM=new At(this),this.pointerDOM=new ft(this),this.paused=t&&t.paused||!1,this._renderer=new Ot(t)}get element(){return this._renderer.element}get layers(){return this._renderer.layers}get height(){return this._renderer.height}get width(){return this._renderer.width}get scale(){return this._renderer.scale}get viewport(){return this._renderer.viewport||this._renderer.updateViewport()}set height(t){this._renderer.height=t}set width(t){this._renderer.width=t}set scale(t){this._renderer.scale=t}tick(t){this.paused||this.layers.render(this._renderer,t)}}},event:{Event:dt,EventEmitter_Mixins:at},geom:{Matrix:lt,Polygon:O,Rectangle:Pt,Vector:ut},media:{WebAudio:Rt},net:{Ajax:Dt},resource:{LoadQueue:Ut},system:{Ticker:class{constructor(t=60){this._isRAF=!1,this._paused=!1,this._tickers=[],this._targetFPS=0,this._measuredFPS=0,this._interval=0,this._intervalId=null,this._lastTime=0,this._tickCount=0,this._tickTime=0,this._targetFPS=t,this._interval=1e3/this._targetFPS}get measuredFPS(){return w.min(this._measuredFPS,this._targetFPS)}_tick(){if(this._paused)return;let t=st(),e=t-this._lastTime;++this._tickCount>=this._targetFPS?(this._measuredFPS=1e3/(this._tickTime/this._tickCount)+.5>>0,this._tickCount=0,this._tickTime=0):this._tickTime+=e,this._lastTime=t;let i=this._tickers.slice(0);for(let t=0,s=i.length;t<s;t++)i[t].tick({deltaTime:e})}start(t){if(this._intervalId)return;let e=this,i=null,s=y.requestAnimationFrame;t=!1!==t,this._lastTime=st(),t&&s&&this._interval<17?(this._isRAF=t,i=function(){e._intervalId=s(i),e._tick()}):i=function(){e._intervalId=y.setTimeout(i,e._interval),e._tick()},this._paused=!1,i()}stop(){this._isRAF?y.cancelAnimationFrame(this._intervalId):y.clearTimeout(this._intervalId),this._intervalId=null,this._lastTime=0,this._paused=!0}pause(){this._paused=!0}resume(){this._paused=!1}addTick(t){if(!t||"function"!=typeof t.tick)throw new Error("Ticker: The tick object must implement the tick method.");this._tickers.push(t)}removeTick(t){let e=this._tickers,i=e.indexOf(t);i>=0&&e.splice(i,1)}nextTick(t){let e=this,i={tick:function(s){e.removeTick(i),t(s)}};return e.addTick(i),i}timeoutTick(t,e){let i=this,s=st()+e,r={tick:function(e){st()-s>=0&&(i.removeTick(r),t(e))}};return i.addTick(r),r}interval(t,e){let i=st()+e,s={tick:function(s){let r=st(),n=r-i;n>=0&&(n<e&&(r-=n),i=r+e,t(s))}};return this.addTick(s),s}}},tween:{Ease:Gt,EaseSports:ee,Tween:se},util:{Browser:J,Util:rt,PerfMon:ht}};return re}));
